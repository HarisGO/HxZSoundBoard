<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SoundBoard</title>
<link rel="stylesheet" href="styles.css">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”Š</text></svg>">
<meta name="theme-color" content="#0d0d0f">
<style>
/* hide upload block completely */
#addCard { display: none !important; }
</style>
</head>
<body>
<header>
  <h1 id="headline">SoundBoard</h1>
  <div id="controls">
    <select id="lang"></select>
    <button id="theme">ğŸŒ“</button>
    <button id="refresh">â†» <span class="lbl">Refresh</span></button>
    <label><input id="overlap" type="checkbox"> <span class="lbl">Play together</span></label>
  </div>
</header>

<section id="wall"></section>

<div id="transport">
  <button id="playBtn">â–¶</button>
  <span id="time">0:00 / 0:00</span>
  <input id="progress" type="range" value="0" step="0.1" min="0" max="100">
  <input id="volume" type="range" value="70" min="0" max="100" title="Volume">
</div>

<script type="module">
/* ========= 1. I18N ========= */
const i18n={
  en:{headline:"SoundBoard",refresh:"Refresh",together:"Play together",time:"Time"},
  ur:{headline:"Ø³Ø§Ø¤Ù†Úˆ Ø¨ÙˆØ±Úˆ",refresh:"Ø±ÛŒÙØ±ÛŒØ´",together:"Ø§ÛŒÚ© Ø³Ø§ØªÚ¾ Ú†Ù„Ø§Ø¦ÛŒÚº",time:"ÙˆÙ‚Øª"},
  ar:{headline:"Ù„ÙˆØ­Ø© Ø§Ù„ØµÙˆØª",refresh:"ØªØ­Ø¯ÙŠØ«",together:"Ø´ØºÙ‘Ù„ Ù…Ø¹Ù‹Ø§",time:"Ø§Ù„ÙˆÙ‚Øª"},
  ps:{headline:"ØºÚ–ÙˆÙ†Ùˆ Ø¨ÙˆØ±Ú‰",refresh:"ØªØ§Ø²Ù‡ Ú©ÙˆÙ„",together:"ÛŒÙˆÚØ§ÛŒ Ù¾Ù„ÛŒ Ú©Ú“Ø¦",time:"ÙˆØ®Øª"},
  fa:{headline:"ØªØ§Ø¨Ù„Ùˆ ØµØ¯Ø§",refresh:"ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ",together:"Ø¨Ø§Ù‡Ù… Ù¾Ø®Ø´ Ø´ÙˆØ¯",time:"Ø²Ù…Ø§Ù†"},
  zh:{headline:"éŸ³æ•ˆæ¿",refresh:"åˆ·æ–°",together:"åŒæ—¶æ’­æ”¾",time:"æ—¶é—´"}
};
let lang='en';
function T(k){return i18n[lang][k]||i18n.en[k]}
function setLang(l){
  lang=l; localStorage.setItem('lang',l);
  document.querySelector('#headline').textContent=T('headline');
  document.querySelector('#refresh .lbl').textContent=T('refresh');
  document.querySelector('label .lbl').textContent=T('together');
}

/* ========= 2. STATE ========= */
let audioCtx=null;
const wall=document.getElementById('wall');
const playBtn=document.getElementById('playBtn');
const prog=document.getElementById('progress');
const vol=document.getElementById('volume');
const overlap=document.getElementById('overlap');
const timeLbl=document.getElementById('time');

/* ========= 3. UTILS ========= */
function fmt(t){const m=Math.floor(t/60),s=Math.floor(t%60);return m+':'+(s<10?'0':'')+s;}
function stopOthers(){if(!overlap.checked&&audioCtx){audioCtx.pause();audioCtx.currentTime=0;}}
async function addCard(name,url){
  const card=document.createElement('div'); card.className='card'; card.dataset.name=name; card.dataset.src=url;
  card.innerHTML=`<audio src="${url}"></audio><div class="title">${name}</div>`;
  const audio=card.querySelector('audio');
  card.onclick=()=>{stopOthers(); audio.play();};
  audio.onplay=()=>{wall.querySelectorAll('.card').forEach(c=>c.classList.remove('playing')); card.classList.add('playing'); audioCtx=audio; syncTransport(audio);};
  audio.onpause=audio.onended=()=>card.classList.remove('playing');
  wall.appendChild(card);
}
function syncTransport(a){
  const upd=()=>{if(a.paused)return; prog.value=100*(a.currentTime/a.duration)||0; timeLbl.textContent=fmt(a.currentTime)+' / '+fmt(a.duration||0); requestAnimationFrame(upd);};
  a.onloadedmetadata=()=>timeLbl.textContent='0:00 / '+fmt(a.duration);
  upd();
}
playBtn.onclick=()=>{if(!audioCtx)return; if(audioCtx.paused){audioCtx.play(); playBtn.textContent='âšâš';}else{audioCtx.pause(); playBtn.textContent='â–¶';}};
prog.oninput=()=>{if(audioCtx)audioCtx.currentTime=prog.value/100*audioCtx.duration;};
vol.oninput=()=>{wall.querySelectorAll('audio').forEach(a=>a.volume=vol.value/100);};

/* ========= 4. SCAN sounds/ FOLDER ========= */
const SOURCE='sounds';
async function scanFolder(base=SOURCE){
  const ext=['mp3','wav','ogg','m4a'];
  const list=[];
  // exact files we already have
  const known=[
    "afg ringtone.mp3","among-us-role-reveal-sound.mp3","drum.mp3","fail.mp3",
    "hello there.mp3","indian.mp3","kid crying.mp3","omg.mp3",
    "radiaton.mp3","shut it.mp3","siren.mp3"
  ];
  for(const k of known){
    const r=await fetch(base+'/'+k,{method:'HEAD'}).catch(()=>null);
    if(r&&r.ok) list.push({name:k, url:base+'/'+k});
  }
  // generic scan (sound0.mp3 ... sound99.mp3 etc.)
  for(const e of ext){
    for(let i=0;i<50;i++){
      const f=(i?`sound${i}`:'sound')+'.'+e;
      const r=await fetch(base+'/'+f,{method:'HEAD'}).catch(()=>null);
      if(r&&r.ok) list.push({name:f, url:base+'/'+f});
    }
  }
  return list;
}
async function refresh(){
  wall.innerHTML='';
  const local=await scanFolder();
  local.forEach(s=>addCard(s.name,s.url));
}
document.getElementById('refresh').onclick=refresh;

/* ========= 5. LANG & THEME ========= */
const sel=document.getElementById('lang'); Object.keys(i18n).forEach(l=>sel.add(new Option(l.toUpperCase(),l)));
sel.value=localStorage.getItem('lang')||'en'; setLang(sel.value);
sel.onchange=(e)=>setLang(e.target.value);
document.getElementById('theme').onclick=()=>document.body.classList.toggle('light');

/* ========= 6. KEYBOARD ========= */
window.onkeydown=e=>{
  if(!audioCtx) return;
  if(e.code==='Space'){e.preventDefault();playBtn.click();}
  else if(e.code==='ArrowLeft') audioCtx.currentTime=Math.max(0,audioCtx.currentTime-5);
  else if(e.code==='ArrowRight')audioCtx.currentTime=Math.min(audioCtx.duration,audioCtx.currentTime+5);
  else if(e.code==='ArrowUp')   vol.value=Math.min(100,parseInt(vol.value)+5);
  else if(e.code==='ArrowDown') vol.value=Math.max(0,parseInt(vol.value)-5);
  vol.oninput();
};

/* ========= 7. INIT ========= */
refresh();
</script>
</body>
</html>
