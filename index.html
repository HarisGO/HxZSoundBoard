<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SoundBoard</title>
<link rel="stylesheet" href="styles.css">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”Š</text></svg>">
<meta name="theme-color" content="#0d0d0f">
</head>
<body>
<header>
  <h1 id="headline">SoundBoard</h1>
  <div id="controls">
    <select id="lang"></select>
    <button id="theme">ðŸŒ“</button>
    <button id="refresh">â†» <span class="lbl">Refresh</span></button>
    <label><input id="overlap" type="checkbox"> <span class="lbl">Play together</span></label>
  </div>
</header>

<section id="wall"></section>

<div id="addCard" class="card">
  <div class="title">Post your sound</div>
  <div class="lang">Upload MP3 / WAV / OGG â€“ stored locally</div>
  <button id="pickBtn">Choose file</button>
  <input id="fileIn" type="file" accept="audio/*">
</div>

<div id="transport">
  <button id="playBtn">â–¶</button>
  <span id="time">0:00 / 0:00</span>
  <input id="progress" type="range" value="0" step="0.1" min="0" max="100">
  <input id="volume" type="range" value="70" min="0" max="100" title="Volume">
</div>

<script type="module">
/* 1. I18N */
const i18n={
  en:{headline:"SoundBoard",refresh:"Refresh",together:"Play together",post:"Post your sound",stored:"stored locally",choose:"Choose file",time:"Time"},
  ur:{headline:"Ø³Ø§Ø¤Ù†Úˆ Ø¨ÙˆØ±Úˆ",refresh:"Ø±ÛŒÙØ±ÛŒØ´",together:"Ø§ÛŒÚ© Ø³Ø§ØªÚ¾ Ú†Ù„Ø§Ø¦ÛŒÚº",post:"Ø§Ù¾Ù†Ø§ Ø¢ÙˆØ§Ø² ÚˆØ§Ù„ÛŒÚº",stored:"Ø¨Ø±Ø§Ø¤Ø²Ø± Ù…ÛŒÚº Ù…Ø­ÙÙˆØ¸",choose:"ÙØ§Ø¦Ù„ Ú†Ù†ÛŒÚº",time:"ÙˆÙ‚Øª"},
  ar:{headline:"Ù„ÙˆØ­Ø© Ø§Ù„ØµÙˆØª",refresh:"ØªØ­Ø¯ÙŠØ«",together:"Ø´ØºÙ‘Ù„ Ù…Ø¹Ù‹Ø§",post:"Ø£Ø¶Ù ØµÙˆØªÙƒ",stored:"ÙŠÙØ®Ø²Ù‘Ù† Ø¨Ø§Ù„Ù…ØªØµÙØ­",choose:"Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§",time:"Ø§Ù„ÙˆÙ‚Øª"},
  ps:{headline:"ØºÚ–ÙˆÙ†Ùˆ Ø¨ÙˆØ±Ú‰",refresh:"ØªØ§Ø²Ù‡ Ú©ÙˆÙ„",together:"ÛŒÙˆÚØ§ÛŒ Ù¾Ù„ÛŒ Ú©Ú“Ø¦",post:"Ø®Ù¾Ù„ ØºÚ– ÙˆØ±Ú©Ú“Ø¦",stored:"Ù¾Ù‡ Ø¨Ø±Ø§ÙˆØ²Ø± Ú©Û Ø®ÙˆÙ†Ø¯ÙŠ",choose:"ÙØ§ÛŒÙ„ ÙˆÙ¼Ø§Ú©Ø¦",time:"ÙˆØ®Øª"},
  fa:{headline:"ØªØ§Ø¨Ù„Ùˆ ØµØ¯Ø§",refresh:"ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ",together:"Ø¨Ø§Ù‡Ù… Ù¾Ø®Ø´ Ø´ÙˆØ¯",post:"ØµØ¯Ø§ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯",stored:"Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯",choose:"Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„",time:"Ø²Ù…Ø§Ù†"},
  zh:{headline:"éŸ³æ•ˆæ¿",refresh:"åˆ·æ–°",together:"åŒæ—¶æ’­æ”¾",post:"ä¸Šä¼ ä½ çš„å£°éŸ³",stored:"ä»…ä¿å­˜åœ¨æµè§ˆå™¨",choose:"é€‰æ‹©æ–‡ä»¶",time:"æ—¶é—´"}
};
let lang='en';
function T(k){return i18n[lang][k]||i18n.en[k]}
function setLang(l){
  lang=l; localStorage.setItem('lang',l);
  document.querySelector('#headline').textContent=T('headline');
  document.querySelector('#refresh .lbl').textContent=T('refresh');
  document.querySelector('label .lbl').textContent=T('together');
  document.querySelector('#addCard .title').textContent=T('post');
  document.querySelector('#addCard .lang').textContent=T('stored');
  document.querySelector('#pickBtn').textContent=T('choose');
}

/* 2. STATE */
let audioCtx=null;
const wall=document.getElementById('wall');
const playBtn=document.getElementById('playBtn');
const prog=document.getElementById('progress');
const vol=document.getElementById('volume');
const overlap=document.getElementById('overlap');
const timeLbl=document.getElementById('time');

/* 3. INDEXEDDB */
let db;
import{openDB}from'https://unpkg.com/idb?module';
(async()=>{db=await openDB('SB',1,{upgrade(d){d.createObjectStore('ups',{keyPath:'name'});}});})();

/* 4. UTILS */
function fmt(t){const m=Math.floor(t/60),s=Math.floor(t%60);return m+':'+(s<10?'0':'')+s;}
function stopOthers(){if(!overlap.checked&&audioCtx){audioCtx.pause();audioCtx.currentTime=0;}}
async function addCard(name,url){
  const card=document.createElement('div'); card.className='card'; card.dataset.name=name; card.dataset.src=url;
  card.innerHTML=`<audio src="${url}"></audio><div class="title">${name}</div><div class="lang">${T('stored')}</div>`;
  const audio=card.querySelector('audio');
  card.onclick=()=>{stopOthers(); audio.play();};
  audio.onplay=()=>{wall.querySelectorAll('.card').forEach(c=>c.classList.remove('playing')); card.classList.add('playing'); audioCtx=audio; syncTransport(audio);};
  audio.onpause=audio.onended=()=>card.classList.remove('playing');
  wall.appendChild(card);
}
function syncTransport(a){
  const upd=()=>{if(a.paused)return; prog.value=100*(a.currentTime/a.duration)||0; timeLbl.textContent=fmt(a.currentTime)+' / '+fmt(a.duration||0); requestAnimationFrame(upd);};
  a.onloadedmetadata=()=>timeLbl.textContent='0:00 / '+fmt(a.duration);
  upd();
}
playBtn.onclick=()=>{if(!audioCtx)return; if(audioCtx.paused){audioCtx.play(); playBtn.textContent='âšâš';}else{audioCtx.pause(); playBtn.textContent='â–¶';}};
prog.oninput=()=>{if(audioCtx)audioCtx.currentTime=prog.value/100*audioCtx.duration;};
vol.oninput=()=>{wall.querySelectorAll('audio').forEach(a=>a.volume=vol.value/100);};

/* 5. SCAN SOURCES */
const GD_ID='1d2EnaQQ3S2bwUN4JlMJydlifmJE5kZ6A'; // your folder
async function scanGDrive(){
  const url=`https://www.googleapis.com/drive/v3/files?q='${GD_ID}'+and+trashed=false&fields=files(name,webContentLink)&key=AIzaSyC1grvJpJLKxL5ebH2xhpBBODfu5M0I7ao`;
  const j=await fetch(url).then(r=>r.json()).catch(()=>({files:[]}));
  return j.files.filter(f=>/\.(mp3|wav|ogg|m4a)$/i.test(f.name)).map(f=>({name:f.name,url:f.webContentLink}));
}
async function refresh(){
  wall.innerHTML='';
  // gdrive
  const gd=await scanGDrive();
  gd.forEach(s=>addCard(s.name,s.url));
  // uploads
  const ups=await db.getAll('ups');
  for(const u of ups) addCard(u.name,URL.createObjectURL(u.blob));
}
document.getElementById('refresh').onclick=refresh;

/* 6. UPLOAD */
document.getElementById('pickBtn').onclick=()=>document.getElementById('fileIn').click();
document.getElementById('fileIn').onchange=async(e)=>{
  const f=e.target.files[0]; if(!f) return;
  await db.put('ups',{name:f.name,blob:f});
  addCard(f.name,URL.createObjectURL(f));
  e.target.value='';
};

/* 7. LANG & THEME */
const sel=document.getElementById('lang'); Object.keys(i18n).forEach(l=>sel.add(new Option(l.toUpperCase(),l)));
sel.value=localStorage.getItem('lang')||'en'; setLang(sel.value);
sel.onchange=(e)=>setLang(e.target.value);
document.getElementById('theme').onclick=()=>document.body.classList.toggle('light');

/* 8. KEYBOARD */
window.onkeydown=e=>{
  if(!audioCtx) return;
  if(e.code==='Space'){e.preventDefault();playBtn.click();}
  else if(e.code==='ArrowLeft') audioCtx.currentTime=Math.max(0,audioCtx.currentTime-5);
  else if(e.code==='ArrowRight')audioCtx.currentTime=Math.min(audioCtx.duration,audioCtx.currentTime+5);
  else if(e.code==='ArrowUp')   vol.value=Math.min(100,parseInt(vol.value)+5);
  else if(e.code==='ArrowDown') vol.value=Math.max(0,parseInt(vol.value)-5);
  vol.oninput();
};

/* 9. INIT */
refresh();
</script>
</body>
</html>